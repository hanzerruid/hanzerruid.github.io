
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="双语之城的博客">
    <title>基因芯片分析 - 双语之城的博客</title>
    <meta name="author" content="双语之城">
    
    
        <link rel="icon" href="http://myqaq.cn/assets/images/timg.jpg">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"双语之城","sameAs":["https://github.com/hanzerruid/hanzerruid.github.io"],"image":"auther.jpg"},"articleBody":"基因芯片分析是生物信息学的重要应用之一，今天总结其中一种简单的使用方法。\n一. 获取数据样本数据选取了论文Molecular subsets of mantle cell lymphoma defined by the IGHV mutational status and SOX11 expression have distinct biologic and clinical features.的实验数据，该套数据的下载网址：https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE36000&amp;format=file从NCBI的GEO数据库获取数据的全部信息https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE36000这张芯片主要是研究来自Mantle细胞淋巴瘤（MCL）患者的B细胞淋巴细胞的免疫球蛋白重链可变（IGHV）基因的突变（MUT）与非突变(UNMUT)芯片共38张，其中24张为突变型（MUT），14张为非突变型（UNMUT）\n二. 数据预处理过程梳理质量检测——背景处理、归一化、汇总——探针注释——合并重复探针\n1.质量检验数据读入123456789101112131415161718192021#初次使用，下载 CLL package#library(BiocInstaller)#biocLite(&quot;CLL&quot;)#biocLite(&quot;simpleaffy&quot;)#install.packages(&quot;scales&quot;)library(affy)library(tcltk)library(gcrma)library(RColorBrewer)library(simpleaffy)library(CLL)setwd(&quot;E:/生信/大三/转录组学&quot;)geneCELs=list.celfiles(&apos;E:/生信/大三/转录组学/GSE36000_RAW/&apos;,full.name=T)data.raw&lt;-ReadAffy(filenames=geneCELs)#basename(geneCELs)     #查看文件名#由于数据分布本身极不规则，这里通过sublime text的优质工具便捷导入名称treats &lt;- strsplit(&quot;UNMUT UNMUT UNMUT UNMUT UNMUT MUT MUT UNMUT UNMUT UNMUT MUT UNMUT MUT MUT MUT MUT MUT MUT MUT MUT MUT MUT UNMUT MUT MUT MUT MUT MUT MUT UNMUT UNMUT MUT MUT MUT MUT MUT UNMUT UNMUT&quot;, &quot; &quot;)[[1]]snames &lt;- strsplit(&quot;UNMUT1 UNMUT2 UNMUT3 UNMUT4 UNMUT5 MUT1 MUT2 UNMUT6 UNMUT7 UNMUT8 MUT3 UNMUT9 MUT4 MUT5 MUT6 MUT7 MUT8 MUT9 MUT10 MUT11 MUT12 MUT13 UNMUT10 MUT14 MUT15 MUT16 MUT17 MUT18 MUT19 UNMUT11 UNMUT12 MUT20 MUT21 MUT22 MUT23 MUT24 UNMUT13 UNMUT14&quot;, &quot; &quot;)[[1]]sampleNames(data.raw) &lt;- snames\nstep0.首先对芯片进行质量检测(是否存在spatial artifact)123456for (i in 1:length(sampleNames(data.raw)))&#123;  name = paste(&quot;image&quot;,sampleNames(data.raw)[i],&quot;.jpg&quot;,sep=&quot;&quot;)  jpeg(name)  image(data.raw[,i])  dev.off()&#125;\n下面为MUT1芯片，所有芯片均完好，无spatial artifact\n2.标准化step1.背景处理、归一化：MAS5/rma/gcrma12345678910111213# mas5data.raw.mas5 &lt;- mas5(data.raw)data.mas5.Matrix &lt;- exprs(data.raw.mas5)    ## rmadata.raw.rma &lt;- rma(data.raw)data.rma.Matrix &lt;- exprs(data.raw.rma)# gcrmadata.raw.gcrma &lt;- gcrma(data.raw)data.gcrma.Matrix &lt;- exprs(data.raw.gcrma)## boxplotboxplot(data.mas5.Matrix, las=3, ylim=c(0,600), main=&quot;MAS 5.0&quot;)boxplot(data.rma.Matrix, las=3, ylim=c(0,8), main=&quot;RMA&quot;)boxplot(data.gcrma.Matrix, las=3, ylim=c(0,8), main=&quot;gcRMA&quot;)\n\n\n\nRMA拖尾情况最少，相对而言最好3.过滤探针123456789calls &lt;- mas5calls(data.raw) # 获得探针的PMA信息calls &lt;- exprs(calls) # 提取包含探针的PMA信息的表达矩阵head(calls)present &lt;- rowSums(calls == &quot;P&quot;) # 统计每个探针在所有样本中分类为&quot;P&quot;的个数present &lt;- which(present != 0) # 提取至少在一个样本中表达的探针rmaFiltered &lt;- data.raw.rma[present,] # 留下至少在一个样本中表达的探针#nrow(rmaFiltered)#Features #   38652\n\n4.探针注释123456789101112library(GEOquery)gse36&lt;-getGEO(&apos;GSE36000&apos;,destdir =&quot;.&quot;) #根据GSE号来下载数据，下载_series_matrix.txt.gzgpl570&lt;-getGEO(&apos;GPL570&apos;,destdir =&quot;.&quot;)  #根据GPL号下载的是芯片设计的信息, soft文件colnames(Table(gpl570)) #提取探针注释信息，保留第1列和第4列genename &lt;- Table(gpl515)[,c(1,4)]exprSet &lt;- as.data.frame(exprs(gse382[[1]]))# 得到表达矩阵，行名为ID，需要转换#转换ID为gene nameexprSet$ID &lt;- rownames(exprSet)express &lt;- merge(x = genename, y = exprSet, by = &quot;ID&quot;)express$ID =NULL\n5. 合并重复探针12345678910#安装hgu133plus2.db包#if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE))#    install.packages(&quot;BiocManager&quot;)#BiocManager::install(&quot;hgu133plus2.db&quot;, version = &quot;3.8&quot;)library(hgu133plus2.db) #加载芯片注释包columns(hgu133plus2.db) #查看芯片注释包提供的注释信息probe2symbol &lt;- toTable(hgu133plus2SYMBOL) #提取注释信息，这里选择GENESYMBOL进行注释。也可以选择其他ID进行注释，详情请见注释包的技术支持文档。exprSet &lt;- as.data.frame(exprs(rmaFiltered)) #提取表达矩阵，转换为data.frame对象head(exprSet) #查看表达矩阵\n\n1234567891011exprSet$probe_id &lt;- rownames(exprSet) #将行名转化为probe_idprobeset &lt;- rownames(exprSet) #提取行名为探针名Symbol &lt;- as.character(as.list(hgu133plus2SYMBOL[probeset])) #提取探针对应的GENESYMBOLexprSet_symbol &lt;- cbind(Symbol,exprSet)#采取数据中位数代替重复值exprSet_symbol &lt;- aggregate(x = exprSet_symbol[,-1],by = list(exprSet_symbol$Symbol), FUN = median)exprSet_symbol$probe_id &lt;- NULLdim(exprSet_symbol)#[1] 15672    39\n\n注意，此处的生成数据是经过RMA修正的，因此是求log后的值三. 基因的差异表达分析将数据处理成纯数据12exprSet_symbol_1&lt;-exprSet_symbol[,-1]rownames(exprSet_symbol_1)&lt;-exprSet_symbol[,1]\n1. t.test1234567891011121314151617181920unmut&lt;-exprSet_symbol_1[,c(1,2,3,4,5,8,9,10,12,23,30,31,37,38)]mut&lt;-exprSet_symbol_1[,c(6,7,11,13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29,32,33,34,35,36)]for(i in 1:nrow(exprSet_symbol_1))&#123;    p_value[i]&lt;-t.test(unmut[i,],mut[i,])$p.value&#125;exprSet_symbol_1$p_value&lt;-p_valueexprSet_symbol_p_005 &lt;- exprSet_symbol_1[p_value&lt;0.05,]#dim(exprSet_symbol_p)#[1] 2503   39exprSet_symbol_p_001 &lt;- exprSet_symbol_1[p_value&lt;0.01,]#dim(exprSet_symbol_p)#[1] 969  39exprSet_symbol_unlog&lt;-2^exprSet_symbol_1unmut&lt;-exprSet_symbol_unlog[,c(1,2,3,4,5,8,9,10,12,23,30,31,37,38)]mut&lt;-exprSet_symbol_unlog[,c(6,7,11,13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29,32,33,34,35,36)]\n2.倍数法12345678910unmut_avg&lt;-apply(unmut,1,mean)mut_avg&lt;-apply(mut,1,mean)exprSet_symbol_1$unmut_avg&lt;-unmut_avgexprSet_symbol_1$mut_avg&lt;-mut_avgexprSet_symbol_fold_2 &lt;- exprSet_symbol_1[2^(log2(unmut_avg/mut_avg))&gt;2,]# dim(exprSet_symbol_fold)# [1] 407  41exprSet_symbol_fold_3 &lt;- exprSet_symbol_1[2^(log2(unmut_avg/mut_avg))&gt;3,]# dim(exprSet_symbol_fold_3)# [1] 145  43\n3.z值123456789101112exprSet_symbol_1$avg_cha&lt;-abs(unmut_avg-mut_avg)exprSet_symbol_z&lt;-vector(length=nrow(exprSet_symbol_1))for(i in 1:nrow(exprSet_symbol_1))&#123;    exprSet_symbol_z[i]&lt;-(exprSet_symbol_1$avg_cha[i]-mean(exprSet_symbol_1$avg_cha))/sd(exprSet_symbol_1$avg_cha)&#125;exprSet_symbol_1$exprSet_symbol_z&lt;-abs(exprSet_symbol_z)exprSet_symbol_zscore_196&lt;-exprSet_symbol_1[exprSet_symbol_z&gt;1.96,]# dim(exprSet_symbol_zscore)# [1] 305  43exprSet_symbol_zscore_258&lt;-exprSet_symbol_1[exprSet_symbol_z&gt;2.58,]# dim(exprSet_symbol_zscore_258)# [1] 224  43\n4.筛选12345678910111213141516171819#t 0.05  倍数 2exprSet_symbol_t005_fold2&lt;-exprSet_symbol_fold_2[exprSet_symbol_fold_2$p_value&lt;0.05,]# dim(exprSet_symbol_t005_fold2)# [1] 283  43#t 0.05  倍数 3exprSet_symbol_t005_fold3&lt;-exprSet_symbol_fold_3[exprSet_symbol_fold_3$p_value&lt;0.05,]# dim(exprSet_symbol_t005_fold3)# [1] 116  43#t 0.05  z 0.05exprSet_symbol_t005_z005&lt;-exprSet_symbol_p_005[exprSet_symbol_p_005$exprSet_symbol_z&gt;1.96,]# dim(exprSet_symbol_t005_z005)# [1] 174  43#t 0.05  z 0.01exprSet_symbol_t005_z001&lt;-exprSet_symbol_p_005[exprSet_symbol_p_005$exprSet_symbol_z&gt;2.58,]# dim(exprSet_symbol_t005_z001)# [1] 141  43\n（P=0.01&amp;&amp;倍数法3）、（P=0.01&amp;&amp;Z值法0.05）1234exprSet_symbol_t001_fold3&lt;-exprSet_symbol_fold_3[exprSet_symbol_fold_3$p_value&lt;0.01,]exprSet_symbol_t001_fold3_z005&lt;-exprSet_symbol_t001_fold3[exprSet_symbol_t001_fold3$exprSet_symbol_z&gt;1.96,]# dim(exprSet_symbol_t001_fold3_z005)# [1] 13 43\n","dateCreated":"2019-03-22T11:21:43+08:00","dateModified":"2019-04-02T16:13:57+08:00","datePublished":"2019-03-22T11:21:43+08:00","description":"基因芯片分析是生物信息学的重要应用之一，今天总结其中一种简单的使用方法。","headline":"基因芯片分析","image":[null,"undeath.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://myqaq.cn/2019/03/22/gene-chip/"},"publisher":{"@type":"Organization","name":"双语之城","sameAs":["https://github.com/hanzerruid/hanzerruid.github.io"],"image":"auther.jpg","logo":{"@type":"ImageObject","url":"auther.jpg"}},"url":"http://myqaq.cn/2019/03/22/gene-chip/","keywords":"R语言, 生物信息","thumbnailUrl":"undeath.jpg"}</script>
    <meta name="description" content="基因芯片分析是生物信息学的重要应用之一，今天总结其中一种简单的使用方法。">
<meta name="keywords" content="R语言,生物信息">
<meta property="og:type" content="blog">
<meta property="og:title" content="基因芯片分析">
<meta property="og:url" content="http://myqaq.cn/2019/03/22/gene-chip/index.html">
<meta property="og:site_name" content="双语之城的博客">
<meta property="og:description" content="基因芯片分析是生物信息学的重要应用之一，今天总结其中一种简单的使用方法。">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/GSMsource.png">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/imageMUT1.jpg">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/mas.png">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/rma.png">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/gcrma.png">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/rmaout.png">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/exprSet.png">
<meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/pretreat_result.png">
<meta property="og:updated_time" content="2019-04-02T08:13:57.795Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="基因芯片分析">
<meta name="twitter:description" content="基因芯片分析是生物信息学的重要应用之一，今天总结其中一种简单的使用方法。">
<meta name="twitter:image" content="http://myqaq.cn/2019/03/22/gene-chip/GSMsource.png">
<meta name="twitter:creator" content="@zodiacruid">
    
        <link rel="publisher" href="https://plus.google.com/zodiac"/>
    
    
        
    
    
        <meta property="og:image" content="http://myqaq.cn/assets/images/auther.jpg"/>
    
    
    
        <meta property="og:image" content="http://myqaq.cn/2019/03/22/gene-chip/undeath.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://myqaq.cn/2019/03/22/gene-chip/undeath.jpg" />
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-c4ozcsklz4kht2pebhp44xorvyverh23toayhn7i6ubrpyedak24hv1v0hyd.min.css">
    <!--STYLES END-->
    

    
            
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">双语之城的博客</a>
    </div>
    
        
            <a class="header-right-icon " href="#about">
        
        
            <i class="question fa-lg"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/auther.jpg" alt="作者的图片">
                </a>
                <h4 class="sidebar-profile-name">双语之城</h4>
                
                    <h5 class="sidebar-profile-bio"><p>生物狗+编程狗</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="首页">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="标签">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" title="归档">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/hanzerruid/hanzerruid.github.io" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-center
                    post-header-cover--partial" style="background-image:url('/2019/03/22/gene-chip/undeath.jpg');" data-behavior="5">
            
                <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            基因芯片分析
        </h1>
    
    
</div>

            
        </div>

            <div id="main" data-behavior="5"
                 class="hasCover
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
    <div class="post-content markdown"> 
        <div class="main-content-wrap"> 
            <p>基因芯片分析是生物信息学的重要应用之一，今天总结其中一种简单的使用方法。<br><a id="more"></a></p>
<h1 id="一-获取数据"><a href="#一-获取数据" class="headerlink" title="一. 获取数据"></a>一. 获取数据</h1><p>样本数据选取了论文<a href="https://www.ncbi.nlm.nih.gov/pubmed/22915760" target="_blank" rel="noopener">Molecular subsets of mantle cell lymphoma defined by the IGHV mutational status and SOX11 expression have distinct biologic and clinical features.</a>的实验数据，该套数据的下载网址：<br><a href="https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE36000&amp;format=file" target="_blank" rel="noopener">https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE36000&amp;format=file</a><br>从NCBI的GEO数据库获取数据的全部信息<br><a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE36000" target="_blank" rel="noopener">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE36000</a><br><img src="/2019/03/22/gene-chip/GSMsource.png"><br>这张芯片主要是研究来自Mantle细胞淋巴瘤（MCL）患者的B细胞淋巴细胞的免疫球蛋白重链可变（IGHV）基因的突变（MUT）与非突变(UNMUT)<br>芯片共38张，其中24张为突变型（MUT），14张为非突变型（UNMUT）</p>
<h1 id="二-数据预处理"><a href="#二-数据预处理" class="headerlink" title="二. 数据预处理"></a>二. 数据预处理</h1><p>过程梳理<br>质量检测——背景处理、归一化、汇总——探针注释——合并重复探针</p>
<h2 id="1-质量检验"><a href="#1-质量检验" class="headerlink" title="1.质量检验"></a>1.质量检验</h2><p>数据读入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#初次使用，下载 CLL package</span><br><span class="line">#library(BiocInstaller)</span><br><span class="line">#biocLite(&quot;CLL&quot;)</span><br><span class="line">#biocLite(&quot;simpleaffy&quot;)</span><br><span class="line">#install.packages(&quot;scales&quot;)</span><br><span class="line"></span><br><span class="line">library(affy)</span><br><span class="line">library(tcltk)</span><br><span class="line">library(gcrma)</span><br><span class="line">library(RColorBrewer)</span><br><span class="line">library(simpleaffy)</span><br><span class="line">library(CLL)</span><br><span class="line"></span><br><span class="line">setwd(&quot;E:/生信/大三/转录组学&quot;)</span><br><span class="line">geneCELs=list.celfiles(&apos;E:/生信/大三/转录组学/GSE36000_RAW/&apos;,full.name=T)</span><br><span class="line">data.raw&lt;-ReadAffy(filenames=geneCELs)</span><br><span class="line">#basename(geneCELs)     #查看文件名</span><br><span class="line">#由于数据分布本身极不规则，这里通过sublime text的优质工具便捷导入名称</span><br><span class="line">treats &lt;- strsplit(&quot;UNMUT UNMUT UNMUT UNMUT UNMUT MUT MUT UNMUT UNMUT UNMUT MUT UNMUT MUT MUT MUT MUT MUT MUT MUT MUT MUT MUT UNMUT MUT MUT MUT MUT MUT MUT UNMUT UNMUT MUT MUT MUT MUT MUT UNMUT UNMUT&quot;, &quot; &quot;)[[1]]</span><br><span class="line">snames &lt;- strsplit(&quot;UNMUT1 UNMUT2 UNMUT3 UNMUT4 UNMUT5 MUT1 MUT2 UNMUT6 UNMUT7 UNMUT8 MUT3 UNMUT9 MUT4 MUT5 MUT6 MUT7 MUT8 MUT9 MUT10 MUT11 MUT12 MUT13 UNMUT10 MUT14 MUT15 MUT16 MUT17 MUT18 MUT19 UNMUT11 UNMUT12 MUT20 MUT21 MUT22 MUT23 MUT24 UNMUT13 UNMUT14&quot;, &quot; &quot;)[[1]]</span><br><span class="line">sampleNames(data.raw) &lt;- snames</span><br></pre></td></tr></table></figure></p>
<h3 id="step0-首先对芯片进行质量检测-是否存在spatial-artifact"><a href="#step0-首先对芯片进行质量检测-是否存在spatial-artifact" class="headerlink" title="step0.首先对芯片进行质量检测(是否存在spatial artifact)"></a>step0.首先对芯片进行质量检测(是否存在spatial artifact)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for (i in 1:length(sampleNames(data.raw)))&#123;</span><br><span class="line">  name = paste(&quot;image&quot;,sampleNames(data.raw)[i],&quot;.jpg&quot;,sep=&quot;&quot;)</span><br><span class="line">  jpeg(name)</span><br><span class="line">  image(data.raw[,i])</span><br><span class="line">  dev.off()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面为MUT1芯片，所有芯片均完好，无spatial artifact<br><img src="/2019/03/22/gene-chip/imageMUT1.jpg" title="MUT1"></p>
<h2 id="2-标准化"><a href="#2-标准化" class="headerlink" title="2.标准化"></a>2.标准化</h2><h3 id="step1-背景处理、归一化：MAS5-rma-gcrma"><a href="#step1-背景处理、归一化：MAS5-rma-gcrma" class="headerlink" title="step1.背景处理、归一化：MAS5/rma/gcrma"></a>step1.背景处理、归一化：MAS5/rma/gcrma</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># mas5</span><br><span class="line">data.raw.mas5 &lt;- mas5(data.raw)</span><br><span class="line">data.mas5.Matrix &lt;- exprs(data.raw.mas5)    #</span><br><span class="line"># rma</span><br><span class="line">data.raw.rma &lt;- rma(data.raw)</span><br><span class="line">data.rma.Matrix &lt;- exprs(data.raw.rma)</span><br><span class="line"># gcrma</span><br><span class="line">data.raw.gcrma &lt;- gcrma(data.raw)</span><br><span class="line">data.gcrma.Matrix &lt;- exprs(data.raw.gcrma)</span><br><span class="line">## boxplot</span><br><span class="line">boxplot(data.mas5.Matrix, las=3, ylim=c(0,600), main=&quot;MAS 5.0&quot;)</span><br><span class="line">boxplot(data.rma.Matrix, las=3, ylim=c(0,8), main=&quot;RMA&quot;)</span><br><span class="line">boxplot(data.gcrma.Matrix, las=3, ylim=c(0,8), main=&quot;gcRMA&quot;)</span><br></pre></td></tr></table></figure>
<img src="/2019/03/22/gene-chip/mas.png" title="MAS boxplot">
<img src="/2019/03/22/gene-chip/rma.png" title="RMA boxplot">
<img src="/2019/03/22/gene-chip/gcrma.png" title="gcRMA boxplot">
<h6 id="RMA拖尾情况最少，相对而言最好"><a href="#RMA拖尾情况最少，相对而言最好" class="headerlink" title="RMA拖尾情况最少，相对而言最好"></a>RMA拖尾情况最少，相对而言最好</h6><h2 id="3-过滤探针"><a href="#3-过滤探针" class="headerlink" title="3.过滤探针"></a>3.过滤探针</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">calls &lt;- mas5calls(data.raw) # 获得探针的PMA信息</span><br><span class="line">calls &lt;- exprs(calls) # 提取包含探针的PMA信息的表达矩阵</span><br><span class="line">head(calls)</span><br><span class="line">present &lt;- rowSums(calls == &quot;P&quot;) # 统计每个探针在所有样本中分类为&quot;P&quot;的个数</span><br><span class="line">present &lt;- which(present != 0) # 提取至少在一个样本中表达的探针</span><br><span class="line">rmaFiltered &lt;- data.raw.rma[present,] # 留下至少在一个样本中表达的探针</span><br><span class="line">#nrow(rmaFiltered)</span><br><span class="line">#Features </span><br><span class="line">#   38652</span><br></pre></td></tr></table></figure>
<img src="/2019/03/22/gene-chip/rmaout.png" title="RMA操作的输出">
<h2 id="4-探针注释"><a href="#4-探针注释" class="headerlink" title="4.探针注释"></a>4.探针注释</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">library(GEOquery)</span><br><span class="line">gse36&lt;-getGEO(&apos;GSE36000&apos;,destdir =&quot;.&quot;) #根据GSE号来下载数据，下载_series_matrix.txt.gz</span><br><span class="line">gpl570&lt;-getGEO(&apos;GPL570&apos;,destdir =&quot;.&quot;)  #根据GPL号下载的是芯片设计的信息, soft文件</span><br><span class="line"></span><br><span class="line">colnames(Table(gpl570))</span><br><span class="line"> #提取探针注释信息，保留第1列和第4列</span><br><span class="line">genename &lt;- Table(gpl515)[,c(1,4)]</span><br><span class="line">exprSet &lt;- as.data.frame(exprs(gse382[[1]]))# 得到表达矩阵，行名为ID，需要转换</span><br><span class="line">#转换ID为gene name</span><br><span class="line">exprSet$ID &lt;- rownames(exprSet)</span><br><span class="line">express &lt;- merge(x = genename, y = exprSet, by = &quot;ID&quot;)</span><br><span class="line">express$ID =NULL</span><br></pre></td></tr></table></figure>
<h2 id="5-合并重复探针"><a href="#5-合并重复探针" class="headerlink" title="5. 合并重复探针"></a>5. 合并重复探针</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#安装hgu133plus2.db包</span><br><span class="line">#if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE))</span><br><span class="line">#    install.packages(&quot;BiocManager&quot;)</span><br><span class="line">#BiocManager::install(&quot;hgu133plus2.db&quot;, version = &quot;3.8&quot;)</span><br><span class="line"></span><br><span class="line">library(hgu133plus2.db) #加载芯片注释包</span><br><span class="line">columns(hgu133plus2.db) #查看芯片注释包提供的注释信息</span><br><span class="line">probe2symbol &lt;- toTable(hgu133plus2SYMBOL) #提取注释信息，这里选择GENESYMBOL进行注释。也可以选择其他ID进行注释，详情请见注释包的技术支持文档。</span><br><span class="line">exprSet &lt;- as.data.frame(exprs(rmaFiltered)) #提取表达矩阵，转换为data.frame对象</span><br><span class="line">head(exprSet) #查看表达矩阵</span><br></pre></td></tr></table></figure>
<img src="/2019/03/22/gene-chip/exprSet.png" title="exprSet屏幕回显">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">exprSet$probe_id &lt;- rownames(exprSet) #将行名转化为probe_id</span><br><span class="line"></span><br><span class="line">probeset &lt;- rownames(exprSet) #提取行名为探针名</span><br><span class="line">Symbol &lt;- as.character(as.list(hgu133plus2SYMBOL[probeset])) #提取探针对应的GENESYMBOL</span><br><span class="line">exprSet_symbol &lt;- cbind(Symbol,exprSet)</span><br><span class="line"></span><br><span class="line">#采取数据中位数代替重复值</span><br><span class="line">exprSet_symbol &lt;- aggregate(x = exprSet_symbol[,-1],by = list(exprSet_symbol$Symbol), FUN = median)</span><br><span class="line">exprSet_symbol$probe_id &lt;- NULL</span><br><span class="line">dim(exprSet_symbol)</span><br><span class="line">#[1] 15672    39</span><br></pre></td></tr></table></figure>
<img src="/2019/03/22/gene-chip/pretreat_result.png" title="预处理最终结果">
<h5 id="注意，此处的生成数据是经过RMA修正的，因此是求log后的值"><a href="#注意，此处的生成数据是经过RMA修正的，因此是求log后的值" class="headerlink" title="注意，此处的生成数据是经过RMA修正的，因此是求log后的值"></a>注意，此处的生成数据是经过RMA修正的，因此是求log后的值</h5><h1 id="三-基因的差异表达分析"><a href="#三-基因的差异表达分析" class="headerlink" title="三. 基因的差异表达分析"></a>三. 基因的差异表达分析</h1><p>将数据处理成纯数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exprSet_symbol_1&lt;-exprSet_symbol[,-1]</span><br><span class="line">rownames(exprSet_symbol_1)&lt;-exprSet_symbol[,1]</span><br></pre></td></tr></table></figure></p>
<h3 id="1-t-test"><a href="#1-t-test" class="headerlink" title="1. t.test"></a>1. t.test</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">unmut&lt;-exprSet_symbol_1[,c(1,2,3,4,5,8,9,10,12,23,30,31,37,38)]</span><br><span class="line">mut&lt;-exprSet_symbol_1[,c(6,7,11,13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29,32,33,34,35,36)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for(i in 1:nrow(exprSet_symbol_1))&#123;</span><br><span class="line">    p_value[i]&lt;-t.test(unmut[i,],mut[i,])$p.value</span><br><span class="line">&#125;</span><br><span class="line">exprSet_symbol_1$p_value&lt;-p_value</span><br><span class="line">exprSet_symbol_p_005 &lt;- exprSet_symbol_1[p_value&lt;0.05,]</span><br><span class="line">#dim(exprSet_symbol_p)</span><br><span class="line">#[1] 2503   39</span><br><span class="line">exprSet_symbol_p_001 &lt;- exprSet_symbol_1[p_value&lt;0.01,]</span><br><span class="line">#dim(exprSet_symbol_p)</span><br><span class="line">#[1] 969  39</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exprSet_symbol_unlog&lt;-2^exprSet_symbol_1</span><br><span class="line">unmut&lt;-exprSet_symbol_unlog[,c(1,2,3,4,5,8,9,10,12,23,30,31,37,38)]</span><br><span class="line">mut&lt;-exprSet_symbol_unlog[,c(6,7,11,13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29,32,33,34,35,36)]</span><br></pre></td></tr></table></figure>
<h3 id="2-倍数法"><a href="#2-倍数法" class="headerlink" title="2.倍数法"></a>2.倍数法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">unmut_avg&lt;-apply(unmut,1,mean)</span><br><span class="line">mut_avg&lt;-apply(mut,1,mean)</span><br><span class="line">exprSet_symbol_1$unmut_avg&lt;-unmut_avg</span><br><span class="line">exprSet_symbol_1$mut_avg&lt;-mut_avg</span><br><span class="line">exprSet_symbol_fold_2 &lt;- exprSet_symbol_1[2^(log2(unmut_avg/mut_avg))&gt;2,]</span><br><span class="line"># dim(exprSet_symbol_fold)</span><br><span class="line"># [1] 407  41</span><br><span class="line">exprSet_symbol_fold_3 &lt;- exprSet_symbol_1[2^(log2(unmut_avg/mut_avg))&gt;3,]</span><br><span class="line"># dim(exprSet_symbol_fold_3)</span><br><span class="line"># [1] 145  43</span><br></pre></td></tr></table></figure>
<h3 id="3-z值"><a href="#3-z值" class="headerlink" title="3.z值"></a>3.z值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">exprSet_symbol_1$avg_cha&lt;-abs(unmut_avg-mut_avg)</span><br><span class="line">exprSet_symbol_z&lt;-vector(length=nrow(exprSet_symbol_1))</span><br><span class="line">for(i in 1:nrow(exprSet_symbol_1))&#123;</span><br><span class="line">    exprSet_symbol_z[i]&lt;-(exprSet_symbol_1$avg_cha[i]-mean(exprSet_symbol_1$avg_cha))/sd(exprSet_symbol_1$avg_cha)</span><br><span class="line">&#125;</span><br><span class="line">exprSet_symbol_1$exprSet_symbol_z&lt;-abs(exprSet_symbol_z)</span><br><span class="line">exprSet_symbol_zscore_196&lt;-exprSet_symbol_1[exprSet_symbol_z&gt;1.96,]</span><br><span class="line"># dim(exprSet_symbol_zscore)</span><br><span class="line"># [1] 305  43</span><br><span class="line">exprSet_symbol_zscore_258&lt;-exprSet_symbol_1[exprSet_symbol_z&gt;2.58,]</span><br><span class="line"># dim(exprSet_symbol_zscore_258)</span><br><span class="line"># [1] 224  43</span><br></pre></td></tr></table></figure>
<h3 id="4-筛选"><a href="#4-筛选" class="headerlink" title="4.筛选"></a>4.筛选</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#t 0.05  倍数 2</span><br><span class="line">exprSet_symbol_t005_fold2&lt;-exprSet_symbol_fold_2[exprSet_symbol_fold_2$p_value&lt;0.05,]</span><br><span class="line"># dim(exprSet_symbol_t005_fold2)</span><br><span class="line"># [1] 283  43</span><br><span class="line"></span><br><span class="line">#t 0.05  倍数 3</span><br><span class="line">exprSet_symbol_t005_fold3&lt;-exprSet_symbol_fold_3[exprSet_symbol_fold_3$p_value&lt;0.05,]</span><br><span class="line"># dim(exprSet_symbol_t005_fold3)</span><br><span class="line"># [1] 116  43</span><br><span class="line"></span><br><span class="line">#t 0.05  z 0.05</span><br><span class="line">exprSet_symbol_t005_z005&lt;-exprSet_symbol_p_005[exprSet_symbol_p_005$exprSet_symbol_z&gt;1.96,]</span><br><span class="line"># dim(exprSet_symbol_t005_z005)</span><br><span class="line"># [1] 174  43</span><br><span class="line"></span><br><span class="line">#t 0.05  z 0.01</span><br><span class="line">exprSet_symbol_t005_z001&lt;-exprSet_symbol_p_005[exprSet_symbol_p_005$exprSet_symbol_z&gt;2.58,]</span><br><span class="line"># dim(exprSet_symbol_t005_z001)</span><br><span class="line"># [1] 141  43</span><br></pre></td></tr></table></figure>
<p>（P=0.01&amp;&amp;倍数法3）、（P=0.01&amp;&amp;Z值法0.05）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exprSet_symbol_t001_fold3&lt;-exprSet_symbol_fold_3[exprSet_symbol_fold_3$p_value&lt;0.01,]</span><br><span class="line">exprSet_symbol_t001_fold3_z005&lt;-exprSet_symbol_t001_fold3[exprSet_symbol_t001_fold3$exprSet_symbol_z&gt;1.96,]</span><br><span class="line"># dim(exprSet_symbol_t001_fold3_z005)</span><br><span class="line"># [1] 13 43</span><br></pre></td></tr></table></figure></p>
 
            
 
            <!-- 添加的部分 --> 
            <!-- copyright --> 
             <!-- copyright --> 
        </div> 
    </div>

    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/R语言/">R语言</a> <a class="tag tag--primary tag--small t-link" href="/tags/生物信息/">生物信息</a>

            </div>
        
        
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2019 双语之城. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/auther.jpg" alt="作者的图片">
        
            <h4 id="about-card-name">双语之城</h4>
        
            <div id="about-card-bio"><p>生物狗+编程狗</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>学生</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br>
                苏州大学
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/timg.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-dbd16rvloemmuxdzniplmnxxvwoz24eya9wol0b7vvmlokgqsjivmb8dnscy.min.js"></script>
<!--SCRIPTS END-->



    </body>
</html>
<script type="text/javascript">
    /* 鼠标特效 */
    var a_idx = 0;
    jQuery(document).ready(function($) {
       $("body").click(function(e) {
           var a = new Array("有伤害人的人存在的话，也会有能抚慰伤痕的人","隐约雷鸣,阴霾天空,但盼风雨来,能留你在此","全世界会有两万个人是你一见到她就会爱上她的，可你也许一辈子都遇不到一个","曾经发生过的事情不可能忘记，只不过是想不起而已","希望你可以记住我，记住我这样活过，这样在你身边呆过","女人的武器不是眼泪，而是微笑","不管是怎样的回忆，都是我们活过的人生","我并没有找到真爱，但并不代表它不存在","所谓的奇迹就是要发生之后才会有价值存在的吧","想要成为无论多么悲伤的时候，也能够漂亮微笑的人吧","只要有人追忆，往事就不必如烟","浅情终似，行云无定，犹到梦魂中","与众不同的生活方式很累人呢，因为找不到借口","铁甲依旧在");
           var $i = $("<span/>").text(a[a_idx]);
           a_idx = (a_idx + 1) % a.length;
           var x = e.pageX,
           y = e.pageY;
           $i.css({
               "z-index": 999999999999,
               "top": y - 20,
               "left": x,
               "position": "absolute",
               "font-weight": "bold",
               "color": "#82D900"
           });
           $("body").append($i);
           $i.animate({
               "top": y - 180,
               "opacity": 0
           },
           2500,
           function() {
               $i.remove();
           });
       });
    });
</script>